!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("gateschema-transformer")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","gateschema-transformer"],t):t(e.GateSchemaForm={},e.React,e.PropTypes,e.GateSchemaTransformer)}(this,function(e,a,n,i){"use strict";var s="default"in a?a.default:a;function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function p(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n=n&&n.hasOwnProperty("default")?n.default:n,i=i&&i.hasOwnProperty("default")?i.default:i,e.transformer=i,e.createForm=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=e.StateForm,t=e.transformer,c=void 0===t?i:t,r=function(e){function u(e,t){var m,r,a;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),r=this,a=l(u).call(this,e,t),p(d(d(m=!a||"object"!=typeof a&&"function"!=typeof a?d(r):a)),"transformNode",function(e,t){var r=d(d(m)).activePaths,a=m.props.ignoreErrors,n=e.path,o=e.error,i=e.value,s=e.constraints,u=s.type,c=s.other,h=(void 0===c?{}:c).form||{};if(!h.hidden){var l;o&&!a[o.keyword]&&(m.errors.push([n,o]),l=o.msg);var f=Object.assign({},h,{path:n,required:s.required,error:r[n]&&l||void 0,value:i,children:e.children,option:s.option}),p=f.component||("/"===n?"Form":{list:"List",map:"Map",string:"Input",number:"InputNumber",boolean:"Switch",enumList:"Checkbox",enum:"Radio"}[u]);return"Select"===p&&"enumList"===u&&(f.multiple=!0),!f.label&&t&&"list"!==t.constraints.type&&(f.label=n.slice(n.lastIndexOf("/")+1)),f.component=p,m.cache[n]={type:u,item:f},f}}),p(d(d(m)),"handleUserInput",function(e,t,r){var a=!1,n=m.cache[e].type;if("string"===n&&""===t)t=void 0;else if("list"===n&&(a=!0,void 0!==r)){var o=m.activePaths,i={},s=[],u=e+"/";Object.keys(o).forEach(function(e){0===e.indexOf(u)?s.push(e):i[e]=!0});var c,h,l,f=new RegExp("^"+e+"\\/(\\d)(\\/.*)?");s.forEach(function(e){c=e.match(f),h=~~c[1],l=c[2]||"",h<r?i[e]=!0:r<h&&(i[u+(h-1)+l]=!0)}),m.activePaths=i}m.activePaths[e]=!0,m.pathValidationOptions=p({},e,{skipAsync:!1}),m.updateValue(e,t,a)}),p(d(d(m)),"handleSubmit",function(){var t=m.activePaths;Object.keys(m.cache).forEach(function(e){t[e]=!0}),m.renderSchema(function(){0===m.errors.length&&m.props.onSubmit()})}),p(d(d(m)),"renderSchema",function(t){var e=m.state,r=e.value,a=e.schema;m.errors=[],m.cache={};var n={path:"/",value:r,rootData:r,validationOptions:m.validationOptions,pathValidationOptions:m.pathValidationOptions,transform:m.transformNode};c.transform(a,n,function(e){return m.setFormState(e),t&&t()})});var n=e.schema,o=e.value,i=e.name,s=e.debounce;return m.cache={},m.errors=[],m.activePaths={},m.validationOptions={skipAsync:!0,useCache:!0},m.pathValidationOptions={},m.state={schema:n,value:o,formState:null},m.setValueOfFormPath=i?m.setValueOfFormPathViaRedux:m.setValueOfFormPathDirectly,m.renderSchemaDebounced=s?s(m.renderSchema,s):m.renderSchema,e.schema&&m.renderSchema(),m}var t,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}(u,a.Component),h((t=u).prototype,[{key:"setValueOfFormPathDirectly",value:function(e,t,r,a){r[a]=t}},{key:"setValueOfFormPathViaRedux",value:function(e,t,r,a){this.context.store.dispatch({type:"GATESCHEMA_FORM_INPUT_OF_PATH",payload:{name:this.props.name,path:e,value:t,parentValue:r,key:a}})}},{key:"setFormState",value:function(e){var t=this.state,r=t.schema,a=t.value;null==t.formState?this.state={schema:r,value:a,formState:e}:this.setState({schema:r,value:a,formState:e})}},{key:"updateValue",value:function(e,t,r){var a=this.props.value,n=e.split("/").slice(1),o=n.length;if(0===o)return this.setValueOfFormPath("/",t);var i=a||{};i!==a&&this.setValueOfFormPath("/",i);for(var s=o-1,u="",c=0;c<o;c++){var h=n[c];if(u+="/"+h,c<s){var l=i[h];null!=l&&"object"===f(l)||(l="list"===this.cache[u].type?[]:{},this.setValueOfFormPath(u,l,i,h)),i=l}else this.setValueOfFormPath(u,t,i,h)}return r?this.renderSchema():this.renderSchemaDebounced()}},{key:"handleReset",value:function(){this.props.onReset()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,r=e.value,a=e.schema;t.value===r&&t.schema===a||(this.setState({value:r,schema:a,formState:this.state.formState}),this.renderSchema())}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.formState!==t.formState||fasle}},{key:"render",value:function(){var e=this.handleSubmit,t=this.handleReset,r=this.handleUserInput,a=this.children,n=this.state.formState;return s.createElement(o,{state:n,onSubmit:e,onReset:t,onInput:r},a)}},{key:"created",value:function(){if(this.name){var n=this.name,o=vuexModuleName+"/setValueOfFormPath";this.setValueOfFormPath=function(e,t,r,a){this.$store.commit(o,{name:n,path:e,value:t,parentValue:r,key:a})}}var r,a,i;this.$watch("schema",{deep:this.isDeepWatchSchema,handler:this.renderSchema}),this.renderSchemaDebounced=this.debounce?(r=this.renderSchema,a=this.debounce,function(){var e=this,t=arguments;clearTimeout(i),i=setTimeout(function(){i=null,r.apply(e,t)},a)}):this.renderSchema,this.schema&&this.renderSchemaDebounced()}}]),r&&h(t,r),u}();return p(r,"contextTypes",{store:n.object}),p(r,"propTypes",{schema:n.object.isRequired,value:n.any,name:n.string,debounce:n.number,ignoreErrors:n.object}),r.defaultProps={ignoreErrors:{map:!0,list:!0}},r},e.formReducer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.type,a=t.payload;if("GATESCHEMA_FORM_INPUT_OF_PATH"===r){var n=a.name,o=a.path,i=a.value,s=a.parentValue,u=a.key;return"/"===o?Object.assign({},e,p({},n,i)):(s[u]=i,Object.assign({},e))}return e},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gaateschema-form-react.js.map
