!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types"),require("gateschema-transformer")):"function"==typeof define&&define.amd?define(["exports","react","prop-types","gateschema-transformer"],t):t(e.GateSchemaForm={},e.React,e.PropTypes,e.GateSchemaTransformer)}(this,function(e,r,n,i){"use strict";var s="default"in r?r.default:r;function f(e){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function d(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n=n&&n.hasOwnProperty("default")?n.default:n,i=i&&i.hasOwnProperty("default")?i.default:i,e.transformer=i,e.createForm=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=e.StateForm,t=e.transformer,p=void 0===t?i:t,a=function(e){function u(e,t){var m,a,r;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),a=this,r=h(u).call(this,e,t),d(v(v(m=!r||"object"!=typeof r&&"function"!=typeof r?v(a):r)),"transformNode",function(e,t){var a=v(v(m)).activePaths,r=m.props.ignoreErrors,n=e.path,o=e.error,i=e.value,s=e.constraints,u=s.type,c=s.other,h=(void 0===c?{}:c).form||{};if(!h.hidden){var l;o&&!r[o.keyword]&&(m.errors.push(o),l=o.msg);var f=Object.assign({},h,{path:n,required:s.required,error:a[n]&&l||void 0,value:i,children:e.children,option:s.option}),p=f.component||("/"===n?"Form":{list:"List",map:"Map",string:"Input",number:"InputNumber",boolean:"Switch",enumList:"Checkbox",enum:"Radio"}[u]);return"Select"===p&&"enumList"===u&&(f.multiple=!0),!f.label&&t&&"list"!==t.constraints.type&&(f.label=n.slice(n.lastIndexOf("/")+1)),f.component=p,m.cache[n]={type:u,item:f},f}}),d(v(v(m)),"handleUserInput",function(e,t,a){var r=!1,n=m.cache[e].type;if("string"===n&&""===t)t=void 0;else if("list"===n&&(r=!0,void 0!==a)){var o=m.activePaths,i={},s=[],u=e+"/";Object.keys(o).forEach(function(e){0===e.indexOf(u)?s.push(e):i[e]=!0});var c,h,l,f=new RegExp("^"+e+"\\/(\\d)(\\/.*)?");s.forEach(function(e){c=e.match(f),h=~~c[1],l=c[2]||"",h<a?i[e]=!0:a<h&&(i[u+(h-1)+l]=!0)}),m.activePaths=i}m.activePaths[e]=!0,m.pathValidationOptions=d({},e,{skipAsync:!1}),m.updateValue(e,t,r)}),d(v(v(m)),"handleSubmit",function(){var t=m.activePaths;Object.keys(m.cache).forEach(function(e){t[e]=!0}),m.renderSchema({validationOptions:m.submitValidationOptions,cb:function(){m.props.onSubmit(m.errors)}})}),d(v(v(m)),"renderSchema",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=v(v(m)),a=t.validationOptions,r=t.pathValidationOptions,n=e.cb,o=e.validationOptions,i=void 0===o?a:o,s=e.pathValidationOptions,u=void 0===s?r:s,c=m.state,h=c.value,l=c.schema;m.errors=[],m.cache={};var f={path:"/",value:h,rootData:h,validationOptions:i,pathValidationOptions:u,transform:m.transformNode};p.transform(l,f,function(e){return m.setFormState(e),n&&n()})});var n=e.schema,o=e.value,i=e.name,s=e.debounce;return m.cache={},m.errors=[],m.activePaths={},m.validationOptions={skipAsync:!0,useCache:!0},m.submitValidationOptions={useCache:!0},m.pathValidationOptions={},m.state={schema:n,value:o,formState:null},m.setValueOfFormPath=i?m.setValueOfFormPathViaRedux:m.setValueOfFormPathDirectly,m.renderSchemaDebounced=s?s(m.renderSchema,s):m.renderSchema,e.schema&&m.renderSchema(),m}var t,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(u,r.Component),c((t=u).prototype,[{key:"setValueOfFormPathDirectly",value:function(e,t,a,r){a[r]=t}},{key:"setValueOfFormPathViaRedux",value:function(e,t,a,r){this.context.store.dispatch({type:"GATESCHEMA_FORM_INPUT_OF_PATH",payload:{name:this.props.name,path:e,value:t,parentValue:a,key:r}})}},{key:"setFormState",value:function(e){var t=this.state,a=t.schema,r=t.value;null==t.formState?this.state={schema:a,value:r,formState:e}:this.setState({schema:a,value:r,formState:e})}},{key:"updateValue",value:function(e,t,a){var r=this.props.value,n=e.split("/").slice(1),o=n.length;if(0===o)return this.setValueOfFormPath("/",t);var i=r||{};i!==r&&this.setValueOfFormPath("/",i);for(var s=o-1,u="",c=0;c<o;c++){var h=n[c];if(u+="/"+h,c<s){var l=i[h];null!=l&&"object"===f(l)||(l="list"===this.cache[u].type?[]:{},this.setValueOfFormPath(u,l,i,h)),i=l}else this.setValueOfFormPath(u,t,i,h)}return a?this.renderSchema():this.renderSchemaDebounced()}},{key:"handleReset",value:function(){this.props.onReset()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,a=e.value,r=e.schema;t.value===a&&t.schema===r||(this.setState({value:a,schema:r,formState:this.state.formState}),this.renderSchema())}},{key:"shouldComponentUpdate",value:function(e,t){return this.state.formState!==t.formState||fasle}},{key:"render",value:function(){var e=this.handleSubmit,t=this.handleReset,a=this.handleUserInput,r=this.children,n=this.state.formState;return s.createElement(o,{state:n,onSubmit:e,onReset:t,onInput:a},r)}},{key:"created",value:function(){if(this.name){var n=this.name,o=vuexModuleName+"/setValueOfFormPath";this.setValueOfFormPath=function(e,t,a,r){this.$store.commit(o,{name:n,path:e,value:t,parentValue:a,key:r})}}var a,r,i;this.$watch("schema",{deep:this.isDeepWatchSchema,handler:this.renderSchema}),this.renderSchemaDebounced=this.debounce?(a=this.renderSchema,r=this.debounce,function(){var e=this,t=arguments;clearTimeout(i),i=setTimeout(function(){i=null,a.apply(e,t)},r)}):this.renderSchema,this.schema&&this.renderSchemaDebounced()}}]),a&&c(t,a),u}();return d(a,"contextTypes",{store:n.object}),d(a,"propTypes",{schema:n.object.isRequired,value:n.any,name:n.string,debounce:n.number,ignoreErrors:n.object}),a.defaultProps={ignoreErrors:{map:!0,list:!0}},a},e.formReducer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=t.type,r=t.payload;if("GATESCHEMA_FORM_INPUT_OF_PATH"===a){var n=r.name,o=r.path,i=r.value,s=r.parentValue,u=r.key;return"/"===o?Object.assign({},e,d({},n,i)):(s[u]=i,Object.assign({},e))}return e},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=gaateschema-form-react.js.map
